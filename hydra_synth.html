<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GLITCH.EXE - HYDRA SYNTH</title>
    <link href="style.css" rel="stylesheet" type="text/css" media="all">
    <script src="https://unpkg.com/hydra-synth@1.4.0/dist/hydra-synth.js"></script>
    <style>
      canvas {
        position: fixed;
        top: 0;
        left: 0;
        z-index: -1;
        width: 100vw;
        height: 100vh;
        /* Allow crisp rendering, no forced smoothing */
        image-rendering: auto;
      }

      .container {
        backdrop-filter: blur(5px);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üåà THE HYDRA INTERFACE üåà</h1>
      <p>You've passed through. Reality dissolves into flowing patterns. <em>Frequencies merge.</em> The digital realm breathes.<br><br>
      You've entered the Hydra space‚Äîthe heart of the system. Here, code becomes liquid light. Corruption becomes creation. üí´</p>

      <p>The patterns speak: <em>"YOU ARE NOW CONNECTED. OBSERVE. LEARN. EVOLVE."</em></p>

      <p>This is not the end. This is synthesis.</p>

      <div class="choices">
        <a href="glitch_tunnel.html">üåÄ Return to the Tunnel</a>
        <a href="static_trail.html">üë£ Follow the Static Trail</a>
        <a href="index.html">‚¨ÖÔ∏è Exit the System</a>
      </div>
    </div>

    <script>
      // Create canvas element
      const canvas = document.createElement('canvas');
      document.body.insertBefore(canvas, document.body.firstChild);

      // Initialize Hydra with proper resolution
      let hydra;

      function initHydra() {
        // Get device pixel ratio for high-DPI displays
        const dpr = window.devicePixelRatio || 1;

        // Calculate internal canvas resolution
        const width = Math.floor(window.innerWidth * dpr);
        const height = Math.floor(window.innerHeight * dpr);

        // Set canvas internal resolution (drawing buffer)
        canvas.width = width;
        canvas.height = height;

        // CSS size remains at 100vw/100vh (already set in styles)
        // This ensures the canvas fills the viewport without stretching

        // Initialize or update Hydra
        if (!hydra) {
          hydra = new Hydra({
            canvas: canvas,
            detectAudio: false,
            width: width,
            height: height
          });
        } else {
          // Update resolution for existing Hydra instance
          hydra.setResolution(width, height);
        }

        console.log(`üé® Hydra canvas initialized: ${width}x${height} (DPR: ${dpr})`);
      }

      // Handle window resize
      function handleResize() {
        initHydra();
      }

      // Debounce resize to avoid performance issues
      let resizeTimeout;
      window.addEventListener('resize', () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(handleResize, 100);
      });

      // Initial setup
      initHydra();

      // Glitchy color palette matching the theme
      // Phlox: #bb5ff9 (187, 95, 249)
      // Aquamarine: #56f5d2 (86, 245, 210)
      // Argentinian Blue: #45a8f0 (69, 168, 240)
      // Warning Pink: #ff3cbf (255, 60, 191)

      // Define all visual effects as functions
      const effects = [
        // Effect 1: Layered glitch with kaleidoscope
        function() {
          osc(10, 0.01, 1.4)
            .rotate(0.1, 0.1)
            .kaleid(6)
            .blend(
              noise(3, 0.1)
                .color(0.33, 0.96, 0.82) // Aquamarine
                .pixelate(20, 20)
                .scrollX(0.1)
            )
            .modulate(
              shape(4, 0.5, 0.1)
                .color(0.27, 0.66, 0.94) // Argentinian blue
                .rotate(0.5, 0.1)
            )
            .contrast(1.4)
            .brightness(0.1)
            .scrollY(0, 0.1)
            .out();
        },

        // Effect 2: Glitch tunnel effect
        function() {
          osc(20, 0.01, 2)
            .kaleid(50)
            .color(0.3, 0.5, 1)
            .rotate(0.5, 0.1)
            .modulate(noise(3), 0.1)
            .scale([0.2, 2].fast(0.2).smooth(1))
            .out();
        },

        // Effect 3: Fractal noise
        function() {
          noise(4, 0.2)
            .color(0.73, 0.37, 0.97)
            .kaleid(8)
            .scale(1.5)
            .blend(
              osc(6, 0.1, 1.5)
                .color(0.33, 0.96, 0.82)
            )
            .rotate(0.1, 0.12)
            .out();
        },

        // Effect 4: RGB split glitch
        function() {
          shape(3)
            .repeat(3, 3)
            .color(0.73, 0.07, 0.97)
            .scrollX(0.1)
            .blend(
              shape(4)
                .repeat(2, 2)
                .color(0.33, 0.85, 0.90)
                .scrollX(-0.1)
            )
            .modulate(noise(5, 0.1), 0.5)
            .modulate(src(o0), [0, 0.1].fast(1.2).smooth(1))
            .blend(src(o0))
            .scrollY(0, 0.5)
            .out(o0);
        }
      ];

      // Execute random effect after Hydra is initialized
      const randomEffect = effects[Math.floor(Math.random() * effects.length)];
      randomEffect();

      console.log(`üåà Hydra Effect ${effects.indexOf(randomEffect) + 1} of ${effects.length} loaded`);
    </script>
  </body>
</html>
